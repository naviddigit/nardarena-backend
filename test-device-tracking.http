### ========================================
### ğŸŒ Device & Location Tracking - Test Suite
### ========================================

@baseUrl = http://localhost:3001/api
@adminToken = YOUR_ADMIN_TOKEN_HERE
@userToken = YOUR_USER_TOKEN_HERE

### ========================================
### 1ï¸âƒ£ DETECT LOCATION (Public - No Auth)
### ========================================

# Ø§ÛŒÙ† endpoint Ø¢ÛŒâ€ŒÙ¾ÛŒØŒ Ú©Ø´ÙˆØ±ØŒ Ø´Ù‡Ø±ØŒ Ø¯ÛŒÙˆØ§ÛŒØ³ Ùˆ OS Ø´Ù…Ø§ Ø±Ùˆ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯ÙˆÙ†Ù‡
GET {{baseUrl}}/auth/detect-location
Content-Type: application/json

### Expected Response:
# {
#   "ip": "5.100.123.45",
#   "country": "IR",
#   "countryName": "Iran",
#   "city": "Tehran",
#   "device": "Desktop",
#   "os": "Windows 10",
#   "browser": "Chrome 120.0"
# }

### ========================================
### 2ï¸âƒ£ REGISTER WITH COUNTRY (Public - No Auth)
### ========================================

# Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¨Ø§ Ú©Ø´ÙˆØ±
# Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯ÛŒÙˆØ§ÛŒØ³ Ùˆ IP Ø®ÙˆØ¯Ú©Ø§Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´Ù‡
POST {{baseUrl}}/auth/register
Content-Type: application/json

{
  "email": "testuser@example.com",
  "username": "testuser",
  "password": "Test@1234",
  "displayName": "Test User",
  "country": "IR"
}

### Expected Response:
# {
#   "access_token": "eyJhbGc...",
#   "refresh_token": "eyJhbGc...",
#   "user": {
#     "id": "uuid",
#     "email": "testuser@example.com",
#     "username": "testuser",
#     "displayName": "Test User",
#     "country": "IR",
#     "role": "USER"
#   }
# }

### ========================================
### 3ï¸âƒ£ LOGIN (Public - No Auth)
### ========================================

# Ù‡Ø± Ø¨Ø§Ø± login Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯ØŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª device Ùˆ location Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´Ù‡
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "testuser@example.com",
  "password": "Test@1234"
}

### ØªÙˆÚ©Ù† Ø±Ùˆ Ú©Ù¾ÛŒ Ú©Ù† Ùˆ Ø¨Ø§Ù„Ø§ Ø¨Ø²Ø§Ø±:
# @userToken = TOKEN_FROM_RESPONSE

### ========================================
### 4ï¸âƒ£ GET MY LOGIN HISTORY (User Auth Required)
### ========================================

# ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙˆØ±ÙˆØ¯Ù‡Ø§ÛŒ Ø®ÙˆØ¯Øª Ø±Ùˆ Ù…ÛŒâ€ŒØ¨ÛŒÙ†ÛŒ
GET {{baseUrl}}/users/login-history?limit=20
Authorization: Bearer {{userToken}}

### Expected Response:
# [
#   {
#     "id": "uuid",
#     "ipAddress": "5.100.123.45",
#     "country": "IR",
#     "city": "Tehran",
#     "device": "Desktop",
#     "os": "Windows 10",
#     "browser": "Chrome 120.0",
#     "success": true,
#     "createdAt": "2024-12-10T21:00:00Z"
#   }
# ]

### ========================================
### 5ï¸âƒ£ CHECK SUSPICIOUS ACTIVITY (User Auth Required)
### ========================================

# Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù‡ Ø¢ÛŒØ§ ÙˆØ±ÙˆØ¯Ù‡Ø§ÛŒ Ù…Ø´Ú©ÙˆÚ© Ø¯Ø§Ø´ØªÛŒ ÛŒØ§ Ù†Ù‡
GET {{baseUrl}}/users/suspicious-activity?hours=24
Authorization: Bearer {{userToken}}

### Expected Response:
# {
#   "totalLogins": 5,
#   "failedLogins": 1,
#   "uniqueCountries": 2,
#   "uniqueIps": 3,
#   "countries": ["IR", "US"],
#   "ips": ["5.100.123.45", "8.8.8.8"],
#   "recentFailed": [...]
# }

### ========================================
### 6ï¸âƒ£ ADMIN: LIST ALL USERS (Admin Auth Required)
### ========================================

# Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø§ country filter
GET {{baseUrl}}/admin/users?page=1&limit=50&country=IR
Authorization: Bearer {{adminToken}}

### ========================================
### 7ï¸âƒ£ ADMIN: GET USER DETAILS (Admin Auth Required)
### ========================================

# Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ø´Ø§Ù…Ù„:
# - Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… (IP, Country, Device, OS, Browser)
# - 10 ÙˆØ±ÙˆØ¯ Ø§Ø®ÛŒØ±
# - ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ ÙˆØ±ÙˆØ¯Ù‡Ø§ØŒ IP Ù‡Ø§ÛŒ ÛŒÙˆÙ†ÛŒÚ©ØŒ Ú©Ø´ÙˆØ±Ù‡Ø§ÛŒ ÛŒÙˆÙ†ÛŒÚ©

GET {{baseUrl}}/admin/users/USER_ID_HERE/details
Authorization: Bearer {{adminToken}}

### Expected Response:
# {
#   "id": "uuid",
#   "email": "testuser@example.com",
#   "username": "testuser",
#   "country": "IR",
#   
#   // Registration metadata
#   "registrationIp": "5.100.123.45",
#   "registrationCountry": "IR",
#   "registrationDevice": "Desktop",
#   "registrationOs": "Windows 10",
#   "registrationBrowser": "Chrome 120.0",
#   
#   // Recent logins
#   "recentLogins": [...],
#   
#   // Stats
#   "loginStats": {
#     "totalLogins": 15,
#     "uniqueIps": 3,
#     "uniqueCountries": 2,
#     "countries": ["IR", "US"]
#   }
# }

### ========================================
### 8ï¸âƒ£ ADMIN: GET USER LOGIN HISTORY (Admin Auth Required)
### ========================================

# ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú©Ø§Ù…Ù„ ÙˆØ±ÙˆØ¯ ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± Ø®Ø§Øµ
GET {{baseUrl}}/admin/users/USER_ID_HERE/login-history?limit=100
Authorization: Bearer {{adminToken}}

### ========================================
### 9ï¸âƒ£ DATABASE QUERIES (Direct SQL)
### ========================================

# Ø¨Ø¹Ø¯ Ø§Ø² Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…/Ù„Ø§Ú¯ÛŒÙ†ØŒ Ø§ÛŒÙ† query Ù‡Ø§ Ø±Ùˆ Ø¨Ø²Ù† ØªÙˆ pgAdmin ÛŒØ§ Prisma Studio:

# 1. Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±Ø§Ù†:
/*
SELECT 
  username,
  email,
  country,
  registration_ip,
  registration_country,
  registration_device,
  registration_os,
  registration_browser,
  created_at
FROM users
WHERE is_bot = false
ORDER BY created_at DESC
LIMIT 20;
*/

# 2. ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙˆØ±ÙˆØ¯Ù‡Ø§:
/*
SELECT 
  u.username,
  lh.ip_address,
  lh.country,
  lh.city,
  lh.device,
  lh.os,
  lh.browser,
  lh.success,
  lh.fail_reason,
  lh.created_at
FROM login_history lh
JOIN users u ON lh.user_id = u.id
ORDER BY lh.created_at DESC
LIMIT 50;
*/

# 3. ØªØ¹Ø¯Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ù‡ ØªÙÚ©ÛŒÚ© Ú©Ø´ÙˆØ±:
/*
SELECT 
  country,
  COUNT(*) as user_count
FROM users
WHERE is_bot = false AND country IS NOT NULL
GROUP BY country
ORDER BY user_count DESC;
*/

# 4. IP Ù‡Ø§ÛŒ Ù…Ø´Ú©ÙˆÚ© (Ú†Ù†Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø§Ø² ÛŒÚ© IP):
/*
SELECT 
  registration_ip,
  COUNT(DISTINCT id) as user_count,
  STRING_AGG(username, ', ') as usernames
FROM users
WHERE is_bot = false AND registration_ip IS NOT NULL
GROUP BY registration_ip
HAVING COUNT(DISTINCT id) > 1
ORDER BY user_count DESC;
*/

# 5. Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø§ Ø¨ÛŒØ´ØªØ±ÛŒÙ† ÙˆØ±ÙˆØ¯ Ù†Ø§Ù…ÙˆÙÙ‚:
/*
SELECT 
  u.username,
  u.email,
  COUNT(*) as failed_logins,
  MAX(lh.created_at) as last_failed_at
FROM login_history lh
JOIN users u ON lh.user_id = u.id
WHERE lh.success = false
GROUP BY u.id, u.username, u.email
ORDER BY failed_logins DESC
LIMIT 20;
*/

### ========================================
### ğŸ”Ÿ PRISMA STUDIO (Visual Database Browser)
### ========================================

# Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¨ØµØ±ÛŒ:
# cd nard-backend
# npx prisma studio
# Ø¨Ø¹Ø¯ Ø¨Ø±Ùˆ http://localhost:5555
# Ø¬Ø¯Ø§ÙˆÙ„ users Ùˆ login_history Ø±Ùˆ Ú†Ú© Ú©Ù†
